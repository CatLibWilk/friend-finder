<!DOCTYPE html>
    <html lang="en-us">
        <head>
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
            <!-- Bootstrap CSS -->
            <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB" crossorigin="anonymous">
            <!-- <link rel="stylesheet" type= "text/css" href="style.css"> -->
            <title>Friend Finder Survey+</title>
            <style>
                #opaque {
                    position: fixed;
                    top: 0px;
                    left: 0px;
                    width: 100%;
                    height: 100%;
                    z-index: 1000;
                    background-color: white;
                    filter: alpha(opacity=30);
                    opacity: 0.4;
                    transition: opacity 2s ease-in;
                }

            .modal-dialog{
                translate: (0, -500%);
                }

            </style>
        </head>
        <body>
            <div id="container-div" class="container">   
                <div class='opaque'></div>
                <section id="about-section"> 
                    <h2 class="mt-3 bg-warning p-3">Survey Questions</h2>
                    <hr>
                    
                    <h3>About You</h3>
                    <h4>Name (Required)</h4>
                        <input type="text" id="name" class="form-control" required="">
                    
                    <h4>Link to Photo Image (Required)</h4>
                        <input type="text" id="photo" class="form-control" required=""> 
                    <hr>
                </section><!--end of about section-->    
                <section id="questions-section">

                    <h3><strong>Question 1</strong></h3>
                    <h4>I make friends easily.</h4>
                    <select id="q-1" class="form-control form-control-sm">
                        <option value=""></option>
                        <option value="1">1 (Strongly Disagree)</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5 (Strongly Agree)</option>
                    </select>
                    
                    <h3><strong>Question 2</strong></h3>
                    <h4>I have a vivid imagination.</h4>
                    <select id="q-2" class="form-control form-control-sm">
                        <option value=""></option>
                        <option value="1">1 (Strongly Disagree)</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5 (Strongly Agree)</option>
                    </select>

                    <h3><strong>Question 3</strong></h3>
                    <h4>I worry about things.</h4>
                    <select id="q-3" class="form-control form-control-sm">
                        <option value=""></option>
                        <option value="1">1 (Strongly Disagree)</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5 (Strongly Agree)</option>
                    </select>

                    <h3><strong>Question 4</strong></h3>
                    <h4>I love large parties.</h4>
                    <select id="q-4" class="form-control form-control-sm">
                        <option value=""></option>
                        <option value="1">1 (Strongly Disagree)</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5 (Strongly Agree)</option>
                    </select>

                    <h3><strong>Question 5</strong></h3>
                    <h4>I believe in the importance of art.</h4>
                    <select id="q-5" class="form-control form-control-sm">
                        <option value=""></option>
                        <option value="1">1 (Strongly Disagree)</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5 (Strongly Agree)</option>
                    </select>

                    <h3><strong>Question 6</strong></h3>
                    <h4>I'm hot-tempered.</h4>
                    <select id="q-6" class="form-control form-control-sm">
                        <option value=""></option>
                        <option value="1">1 (Strongly Disagree)</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5 (Strongly Agree)</option>
                    </select>

                    <h3><strong>Question 7</strong></h3>
                    <h4>I take charge.</h4>
                    <select id="q-7" class="form-control form-control-sm">
                        <option value=""></option>
                        <option value="1">1 (Strongly Disagree)</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5 (Strongly Agree)</option>
                    </select>

                    <h3><strong>Question 8</strong></h3>
                    <h4>I experience my emotions intensely.</h4>
                    <select id="q-8" class="form-control form-control-sm">
                        <option value=""></option>
                        <option value="1">1 (Strongly Disagree)</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5 (Strongly Agree)</option>
                    </select>

                    <h3><strong>Question 9</strong></h3>
                    <h4>I generally prefer to spend quiet evenings at home.</h4>
                    <select id="q-9" class="form-control form-control-sm">
                        <option value=""></option>
                        <option value="1">1 (Strongly Disagree)</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5 (Strongly Agree)</option>
                    </select>

                    <h3><strong>Question 10</strong></h3>
                    <h4>I always try to stay busy.</h4>
                    <select id="q-10" class="form-control form-control-sm">
                        <option value=""></option>
                        <option value="1">1 (Strongly Disagree)</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5 (Strongly Agree)</option>
                    </select>

                    <button type="button" id="sub-btn" class="btn mt-3 text-white mb-3 bg-primary btn-link col-12">Find a Friend!</button>

                </section><!--end questions section-->
                <section>
                <div class="modal" id="bestMatchDiv">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                               <h2 class="modal-title"><i class="fas fa-exclamation"></i>Your new best friend!</h2><div id="ex" class="btn btn-danger" href="/home">X</div >
                                
                            </div><!--End modal header-->
                            <div class="modal-body">
                                
                            </div><!--End modal body-->
                        </div><!--End modal content-->
                    </div><!--End modal-dialog-->
                  </div> <!--End modal container div-->
                <!--end bestmatch modal
                </section><!-end modal section-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <!-- <script src="script.js"></script> -->
        <script>
        var userObj = {};
        var userScores = [];
        var subBtn = $("#sub-btn");

        subBtn.on("click", (e) => {
                e.preventDefault();
                var userName = $("#name").val().trim();
                var userPhoto = $("#photo").val().trim();

                var q1 = parseInt($("#q-1").val());
                var q2 = parseInt($("#q-2").val());
                var q3 = parseInt($("#q-3").val());
                var q4 = parseInt($("#q-4").val());
                var q5 = parseInt($("#q-5").val());
                var q6 = parseInt($("#q-6").val());
                var q7 = parseInt($("#q-7").val());
                var q8 = parseInt($("#q-8").val());
                var q9 = parseInt($("#q-9").val());
                var q10 = parseInt($("#q-10").val());

                userScores.push(q1, q2, q3, q4, q5, q6, q7, q8, q9, q10);
                userObj.name = userName;
                userObj.photo = userPhoto;
                userObj.scores = userScores;

                $.post("/api/friends", userObj, data => {

                    var newDiv = $("<div>");
                    var newH1 = $("<h1>").text(data[0].name);
                    var newImg = $("<img class='img-fluid'>").attr("src", data[0].photo);
                    newDiv.append(newH1, newImg);
                    $(".modal-body").append(newDiv);


                    let fade = new Promise( (resolve, reject) => {
                        resolve($("#bestMatchDiv").fadeIn(450))
                    });

                    let freeze = new Promise( (resolve, reject) => {
                        resolve($("#bestMatchDiv").modal({ show: true}));
                    });

                    fade().then(freeze);
                    
                });
        });
        $("#ex").on("click", (e) => {
            e.preventDefault();
            
            $("#bestMatchDiv").delay(500).fadeOut(450);

            setTimeout(closeModal, 1000);
            setTimeout(resetPage, 3000);

                function closeModal(){
                    $("#bestMatchDiv").modal("hide");
                };

                function resetPage(){

                    $.post("/close", data => {
                        var currentURL = window.location.origin;
                        window.location.assign(`${currentURL}${data}`);
                    });
                }

            $(".opaque").attr("id", "opaque");
        });
        </script>                
       </body>
    </html>